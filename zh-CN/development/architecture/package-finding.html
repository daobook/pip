<!doctype html>
<html class="no-js" lang="zh_CN">
  <head><meta charset="utf-8"/>
    <meta name="viewport" content="width=device-width,initial-scale=1"/>
    <meta name="color-scheme" content="light dark"><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />
<link rel="search" title="搜索" href="../../search.html" /><link rel="copyright" title="版权所有" href="../../copyright.html" /><link rel="next" title="Command Line Interface" href="command-line-interface.html" /><link rel="prev" title="Configuration File Handling" href="configuration-files.html" />

    <meta name="generator" content="sphinx-4.2.0, furo 2021.10.09"/>
        <title>Finding and choosing files (index and PackageFinder) - pip documentation v22.0.dev0</title>
      <link rel="stylesheet" type="text/css" href="../../_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/styles/furo.css?digest=0254c309f5cadf746f1a613e7677379ac9c8cdcd" />
    <link rel="stylesheet" type="text/css" href="../../_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/tabs.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/styles/furo-extensions.css?digest=16fb25fabf47304eee183a5e9af80b1ba98259b1" />
    
    


<style>
  body {
    --color-code-background: #f8f8f8;
  --color-code-foreground: black;
  
  }
  body[data-theme="dark"] {
    --color-code-background: #202020;
  --color-code-foreground: #d0d0d0;
  
  }
  @media (prefers-color-scheme: dark) {
    body:not([data-theme="light"]) {
      --color-code-background: #202020;
  --color-code-foreground: #d0d0d0;
  
    }
  }
</style></head>
  <body>
    <script>
      document.body.dataset.theme = localStorage.getItem("theme") || "auto";
    </script>
    
<svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
  <symbol id="svg-toc" viewBox="0 0 24 24">
    <title>Contents</title>
    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round">
      <path stroke="none" d="M0 0h24v24H0z" />
      <line x1="4" y1="6" x2="20" y2="6" />
      <line x1="10" y1="12" x2="20" y2="12" />
      <line x1="6" y1="18" x2="20" y2="18" />
    </svg>
  </symbol>
  <symbol id="svg-menu" viewBox="0 0 24 24">
    <title>Menu</title>
    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather-menu">
      <line x1="3" y1="12" x2="21" y2="12"></line>
      <line x1="3" y1="6" x2="21" y2="6"></line>
      <line x1="3" y1="18" x2="21" y2="18"></line>
    </svg>
  </symbol>
  <symbol id="svg-arrow-right" viewBox="0 0 24 24">
    <title>Expand</title>
    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather-chevron-right">
      <polyline points="9 18 15 12 9 6"></polyline>
    </svg>
  </symbol>
  <symbol id="svg-sun" viewBox="0 0 24 24">
    <title>Light mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" class="feather-sun">
      <circle cx="12" cy="12" r="5"></circle>
      <line x1="12" y1="1" x2="12" y2="3"></line>
      <line x1="12" y1="21" x2="12" y2="23"></line>
      <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
      <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
      <line x1="1" y1="12" x2="3" y2="12"></line>
      <line x1="21" y1="12" x2="23" y2="12"></line>
      <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
      <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
    </svg>
  </symbol>
  <symbol id="svg-moon" viewBox="0 0 24 24">
    <title>Dark mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" class="icon-tabler-moon">
      <path stroke="none" d="M0 0h24v24H0z" fill="none" />
      <path d="M12 3c.132 0 .263 0 .393 0a7.5 7.5 0 0 0 7.92 12.446a9 9 0 1 1 -8.313 -12.454z" />
    </svg>
  </symbol>
  <symbol id="svg-sun-half" viewBox="0 0 24 24">
    <title>Auto light/dark mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" class="icon-tabler-shadow">
      <path stroke="none" d="M0 0h24v24H0z" fill="none"/>
      <circle cx="12" cy="12" r="9" />
      <path d="M13 12h5" />
      <path d="M13 15h4" />
      <path d="M13 18h1" />
      <path d="M13 9h4" />
      <path d="M13 6h1" />
    </svg>
  </symbol>
</svg>

<input type="checkbox" class="sidebar-toggle" name="__navigation" id="__navigation">
<input type="checkbox" class="sidebar-toggle" name="__toc" id="__toc">
<label class="overlay sidebar-overlay" for="__navigation">
  <div class="visually-hidden">Hide navigation sidebar</div>
</label>
<label class="overlay toc-overlay" for="__toc">
  <div class="visually-hidden">Hide table of contents sidebar</div>
</label>



<div class="page">
  <header class="mobile-header">
    <div class="header-left">
      <label class="nav-overlay-icon" for="__navigation">
        <div class="visually-hidden">Toggle site navigation sidebar</div>
        <i class="icon"><svg><use href="#svg-menu"></use></svg></i>
      </label>
    </div>
    <div class="header-center">
      <a href="../../index.html"><div class="brand">pip documentation v22.0.dev0</div></a>
    </div>
    <div class="header-right">
      <div class="theme-toggle-container theme-toggle-header">
        <button class="theme-toggle">
          <div class="visually-hidden">Toggle Light / Dark / Auto color theme</div>
          <svg class="theme-icon-when-auto"><use href="#svg-sun-half"></use></svg>
          <svg class="theme-icon-when-dark"><use href="#svg-moon"></use></svg>
          <svg class="theme-icon-when-light"><use href="#svg-sun"></use></svg>
        </button>
      </div>
      <label class="toc-overlay-icon toc-header-icon" for="__toc">
        <div class="visually-hidden">Toggle table of contents sidebar</div>
        <i class="icon"><svg><use href="#svg-toc"></use></svg></i>
      </label>
    </div>
  </header>
  <aside class="sidebar-drawer">
    <div class="sidebar-container">
      
      <div class="sidebar-sticky"><a class="sidebar-brand" href="../../index.html">
  
  
  <span class="sidebar-brand-text">pip documentation v22.0.dev0</span>
  
</a><form class="sidebar-search-container" method="get" action="../../search.html" role="search">
  <input class="sidebar-search" placeholder=搜索 name="q" aria-label="搜索">
  <input type="hidden" name="check_keywords" value="yes">
  <input type="hidden" name="area" value="default">
</form>
<div id="searchbox"></div><div class="sidebar-scroll"><div class="sidebar-tree">
  <ul>
<li class="toctree-l1"><a class="reference internal" href="../../getting-started.html">入门指南</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../installation.html">安装</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../user_guide.html">用户指南</a></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../../topics/index.html">主题指南</a><input class="toctree-checkbox" id="toctree-checkbox-1" name="toctree-checkbox-1" role="switch" type="checkbox"/><label for="toctree-checkbox-1"><div class="visually-hidden">Toggle child pages in navigation</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../../topics/authentication.html">认证</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../topics/caching.html">Caching</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../topics/configuration.html">配置</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../topics/dependency-resolution.html">Dependency Resolution</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../topics/repeatable-installs.html">Repeatable Installs</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../topics/vcs-support.html">VCS Support</a></li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../../reference/index.html">Reference</a><input class="toctree-checkbox" id="toctree-checkbox-2" name="toctree-checkbox-2" role="switch" type="checkbox"/><label for="toctree-checkbox-2"><div class="visually-hidden">Toggle child pages in navigation</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l2 has-children"><a class="reference internal" href="../../reference/build-system/index.html">Build System Interface</a><input class="toctree-checkbox" id="toctree-checkbox-3" name="toctree-checkbox-3" role="switch" type="checkbox"/><label for="toctree-checkbox-3"><div class="visually-hidden">Toggle child pages in navigation</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l3"><a class="reference internal" href="../../reference/build-system/pyproject-toml.html"><code class="docutils literal notranslate"><span class="pre">pyproject.toml</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../reference/build-system/setup-py.html"><code class="docutils literal notranslate"><span class="pre">setup.py</span></code> (legacy)</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../reference/requirements-file-format.html">Requirements File Format</a></li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../../cli/index.html">Commands</a><input class="toctree-checkbox" id="toctree-checkbox-4" name="toctree-checkbox-4" role="switch" type="checkbox"/><label for="toctree-checkbox-4"><div class="visually-hidden">Toggle child pages in navigation</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../../cli/pip.html">pip</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../cli/pip_install.html">pip install</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../cli/pip_uninstall.html">pip uninstall</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../cli/pip_list.html">pip list</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../cli/pip_show.html">pip show</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../cli/pip_freeze.html">pip freeze</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../cli/pip_check.html">pip check</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../cli/pip_download.html">pip download</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../cli/pip_wheel.html">pip wheel</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../cli/pip_hash.html">pip hash</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../cli/pip_search.html">pip search</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../cli/pip_cache.html">pip cache</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../cli/pip_config.html">pip config</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../cli/pip_debug.html">pip debug</a></li>
</ul>
</li>
</ul>
<p class="caption" role="heading"><span class="caption-text">项目</span></p>
<ul class="current">
<li class="toctree-l1 current has-children"><a class="reference internal" href="../index.html">Development</a><input checked="" class="toctree-checkbox" id="toctree-checkbox-5" name="toctree-checkbox-5" role="switch" type="checkbox"/><label for="toctree-checkbox-5"><div class="visually-hidden">Toggle child pages in navigation</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="../getting-started.html">Getting Started</a></li>
<li class="toctree-l2"><a class="reference internal" href="../contributing.html">Contributing</a></li>
<li class="toctree-l2"><a class="reference internal" href="../ci.html">Continuous Integration</a></li>
<li class="toctree-l2"><a class="reference internal" href="../issue-triage.html">Issue Triage</a></li>
<li class="toctree-l2 current has-children"><a class="reference internal" href="index.html">Architecture of pip’s internals</a><input checked="" class="toctree-checkbox" id="toctree-checkbox-6" name="toctree-checkbox-6" role="switch" type="checkbox"/><label for="toctree-checkbox-6"><div class="visually-hidden">Toggle child pages in navigation</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul class="current">
<li class="toctree-l3"><a class="reference internal" href="overview.html">Broad functionality overview</a></li>
<li class="toctree-l3"><a class="reference internal" href="anatomy.html">Repository anatomy &amp; directory structure</a></li>
<li class="toctree-l3"><a class="reference internal" href="configuration-files.html">Configuration File Handling</a></li>
<li class="toctree-l3 current current-page"><a class="current reference internal" href="#">Finding and choosing files (<code class="docutils literal notranslate"><span class="pre">index</span></code> and <code class="docutils literal notranslate"><span class="pre">PackageFinder</span></code>)</a></li>
<li class="toctree-l3"><a class="reference internal" href="command-line-interface.html">Command Line Interface</a></li>
<li class="toctree-l3"><a class="reference internal" href="upgrade-options.html">Options that control the installation process</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../release-process.html">Release process</a></li>
<li class="toctree-l2"><a class="reference internal" href="../vendoring-policy.html">Vendoring Policy</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../ux_research_design.html">UX Research &amp; Design</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../news.html">Changelog</a></li>
<li class="toctree-l1"><a class="reference external" href="https://github.com/pypa/.github/blob/main/CODE_OF_CONDUCT.md">行为准则</a></li>
<li class="toctree-l1"><a class="reference external" href="https://github.com/pypa/pip">GitHub</a></li>
</ul>

</div>
</div>
      </div>
      
    </div>
  </aside>
  <div class="main">
    <div class="content">
      <div class="article-container">
        <div class="content-icon-container">
          <div class="theme-toggle-container theme-toggle-content">
            <button class="theme-toggle">
              <div class="visually-hidden">Toggle Light / Dark / Auto color theme</div>
              <svg class="theme-icon-when-auto"><use href="#svg-sun-half"></use></svg>
              <svg class="theme-icon-when-dark"><use href="#svg-moon"></use></svg>
              <svg class="theme-icon-when-light"><use href="#svg-sun"></use></svg>
            </button>
          </div>
          <label class="toc-overlay-icon toc-content-icon" for="__toc">
            <div class="visually-hidden">Toggle table of contents sidebar</div>
            <i class="icon"><svg><use href="#svg-toc"></use></svg></i>
          </label>
        </div>
        <article role="main">
          <section id="finding-and-choosing-files-index-and-packagefinder">
<h1>Finding and choosing files (<code class="docutils literal notranslate"><span class="pre">index</span></code> and <code class="docutils literal notranslate"><span class="pre">PackageFinder</span></code>)<a class="headerlink" href="#finding-and-choosing-files-index-and-packagefinder" title="永久链接至标题">¶</a></h1>
<p>The <code class="docutils literal notranslate"><span class="pre">pip._internal.index</span></code> sub-package in pip is responsible for deciding
what file to download and from where, given a requirement for a project. The
package’s functionality is largely exposed through and coordinated by the
package’s <code class="docutils literal notranslate"><span class="pre">PackageFinder</span></code> class.</p>
<section id="overview">
<span id="index-overview"></span><h2>Overview<a class="headerlink" href="#overview" title="永久链接至标题">¶</a></h2>
<p>Here is a rough description of the process that pip uses to choose what
file to download for a package, given a requirement:</p>
<ol class="arabic simple">
<li><p>Collect together the various network and file system locations containing
project package files. These locations are derived, for example, from pip’s
<a class="reference internal" href="../../cli/pip_install.html#install-index-url"><span class="std std-ref">--index-url</span></a> (with default
<a class="reference external" href="https://pypi.org/simple/">https://pypi.org/simple/</a> ) setting and any configured
<a class="reference internal" href="../../cli/pip_install.html#install-extra-index-url"><span class="std std-ref">--extra-index-url</span></a> locations. Each of the
project page URL’s is an HTML page of anchor links, as defined in
<a class="reference external" href="https://www.python.org/dev/peps/pep-0503/">PEP 503</a>, the “Simple Repository API.”</p></li>
<li><p>For each project page URL, fetch the HTML and parse out the anchor links,
creating a <code class="docutils literal notranslate"><span class="pre">Link</span></code> object from each one. The <a class="reference internal" href="#link-collector-class"><span class="std std-ref">LinkCollector</span></a> class is responsible for both the previous step
and fetching the HTML over the network.</p></li>
<li><p>Determine which of the links are minimally relevant, using the
<a class="reference internal" href="#link-evaluator-class"><span class="std std-ref">LinkEvaluator</span></a> class.  Create an
<code class="docutils literal notranslate"><span class="pre">InstallationCandidate</span></code> object (aka candidate for install) for each
of these relevant links.</p></li>
<li><p>Further filter the collection of <code class="docutils literal notranslate"><span class="pre">InstallationCandidate</span></code> objects (using
the <a class="reference internal" href="#candidate-evaluator-class"><span class="std std-ref">CandidateEvaluator</span></a> class) to a
collection of “applicable” candidates.</p></li>
<li><p>If there are applicable candidates, choose the best candidate by sorting
them (again using the <a class="reference internal" href="#candidate-evaluator-class"><span class="std std-ref">CandidateEvaluator</span></a> class).</p></li>
</ol>
<p>The remainder of this section is organized by documenting some of the
classes inside the <code class="docutils literal notranslate"><span class="pre">index</span></code> package, in the following order:</p>
<ul class="simple">
<li><p>the main <a class="reference internal" href="#package-finder-class"><span class="std std-ref">PackageFinder</span></a> class,</p></li>
<li><p>the <a class="reference internal" href="#link-collector-class"><span class="std std-ref">LinkCollector</span></a> class,</p></li>
<li><p>the <a class="reference internal" href="#link-evaluator-class"><span class="std std-ref">LinkEvaluator</span></a> class,</p></li>
<li><p>the <a class="reference internal" href="#candidate-evaluator-class"><span class="std std-ref">CandidateEvaluator</span></a> class,</p></li>
<li><p>the <a class="reference internal" href="#candidate-preferences-class"><span class="std std-ref">CandidatePreferences</span></a> class, and</p></li>
<li><p>the <a class="reference internal" href="#best-candidate-result-class"><span class="std std-ref">BestCandidateResult</span></a> class.</p></li>
</ul>
</section>
<section id="the-packagefinder-class">
<span id="package-finder-class"></span><h2>The <code class="docutils literal notranslate"><span class="pre">PackageFinder</span></code> class<a class="headerlink" href="#the-packagefinder-class" title="永久链接至标题">¶</a></h2>
<p>The <code class="docutils literal notranslate"><span class="pre">PackageFinder</span></code> class is the primary way through which code in pip
interacts with <code class="docutils literal notranslate"><span class="pre">index</span></code> package. It is an umbrella class that encapsulates and
groups together various package-finding functionality.</p>
<p>The <code class="docutils literal notranslate"><span class="pre">PackageFinder</span></code> class is responsible for searching the network and file
system for what versions of a package pip can install, and also for deciding
which version is most preferred, given the user’s preferences, target Python
environment, etc.</p>
<p>The pip commands that use the <code class="docutils literal notranslate"><span class="pre">PackageFinder</span></code> class are:</p>
<ul class="simple">
<li><p><a class="reference internal" href="../../cli/pip_download.html#pip-download"><span class="std std-ref">pip download</span></a></p></li>
<li><p><a class="reference internal" href="../../cli/pip_install.html#pip-install"><span class="std std-ref">pip install</span></a></p></li>
<li><p><a class="reference internal" href="../../cli/pip_list.html#pip-list"><span class="std std-ref">pip list</span></a></p></li>
<li><p><a class="reference internal" href="../../cli/pip_wheel.html#pip-wheel"><span class="std std-ref">pip wheel</span></a></p></li>
</ul>
<p>The pip commands requiring use of the <code class="docutils literal notranslate"><span class="pre">PackageFinder</span></code> class generally
instantiate <code class="docutils literal notranslate"><span class="pre">PackageFinder</span></code> only once for the whole pip invocation. In
fact, pip creates this <code class="docutils literal notranslate"><span class="pre">PackageFinder</span></code> instance when command options
are first parsed.</p>
<p>With the exception of <a class="reference internal" href="../../cli/pip_list.html#pip-list"><span class="std std-ref">pip list</span></a>, each of the above commands is
implemented as a <code class="docutils literal notranslate"><span class="pre">Command</span></code> class inheriting from <code class="docutils literal notranslate"><span class="pre">RequirementCommand</span></code>
(for example <a class="reference internal" href="../../cli/pip_download.html#pip-download"><span class="std std-ref">pip download</span></a> is implemented by <code class="docutils literal notranslate"><span class="pre">DownloadCommand</span></code>), and
the <code class="docutils literal notranslate"><span class="pre">PackageFinder</span></code> instance is created by calling the
<code class="docutils literal notranslate"><span class="pre">RequirementCommand</span></code> class’s <code class="docutils literal notranslate"><span class="pre">_build_package_finder()</span></code> method. <code class="docutils literal notranslate"><span class="pre">pip</span>
<span class="pre">list</span></code>, on the other hand, constructs its <code class="docutils literal notranslate"><span class="pre">PackageFinder</span></code> instance by
calling the <code class="docutils literal notranslate"><span class="pre">ListCommand</span></code> class’s <code class="docutils literal notranslate"><span class="pre">_build_package_finder()</span></code>. (This
difference may simply be historical and may not actually be necessary.)</p>
<p>Each of these commands also uses the <code class="docutils literal notranslate"><span class="pre">PackageFinder</span></code> class for pip’s
“self-check,” (i.e. to check whether a pip upgrade is available). In this
case, the <code class="docutils literal notranslate"><span class="pre">PackageFinder</span></code> instance is created by the
<code class="docutils literal notranslate"><span class="pre">self_outdated_check.py</span></code> module’s <code class="docutils literal notranslate"><span class="pre">pip_self_version_check()</span></code> function.</p>
<p>The <code class="docutils literal notranslate"><span class="pre">PackageFinder</span></code> class is responsible for doing all of the things listed
in the <a class="reference internal" href="#index-overview"><span class="std std-ref">Overview</span></a> section like fetching and parsing
<a class="reference external" href="https://www.python.org/dev/peps/pep-0503/">PEP 503</a> simple repository HTML pages, evaluating which links in the simple
repository pages are relevant for each requirement, and further filtering and
sorting by preference the candidates for install coming from the relevant
links.</p>
<p>One of <code class="docutils literal notranslate"><span class="pre">PackageFinder</span></code>’s main top-level methods is
<code class="docutils literal notranslate"><span class="pre">find_best_candidate()</span></code>. This method does the following two things:</p>
<ol class="arabic simple">
<li><p>Calls its <code class="docutils literal notranslate"><span class="pre">find_all_candidates()</span></code> method, which gathers all
possible package links by reading and parsing the index URL’s and
locations provided by the user (the <a class="reference internal" href="#link-collector-class"><span class="std std-ref">LinkCollector</span></a> class’s <code class="docutils literal notranslate"><span class="pre">collect_sources()</span></code> method), constructs a
<a class="reference internal" href="#link-evaluator-class"><span class="std std-ref">LinkEvaluator</span></a> object to filter out some of
those links, and then returns a list of <code class="docutils literal notranslate"><span class="pre">InstallationCandidates</span></code> (aka
candidates for install). This corresponds to steps 1-3 of the
<a class="reference internal" href="#index-overview"><span class="std std-ref">Overview</span></a> above.</p></li>
<li><p>Constructs a <code class="docutils literal notranslate"><span class="pre">CandidateEvaluator</span></code> object and uses that to determine
the best candidate. It does this by calling the <code class="docutils literal notranslate"><span class="pre">CandidateEvaluator</span></code>
class’s <code class="docutils literal notranslate"><span class="pre">compute_best_candidate()</span></code> method on the return value of
<code class="docutils literal notranslate"><span class="pre">find_all_candidates()</span></code>. This corresponds to steps 4-5 of the Overview.</p></li>
</ol>
<p><code class="docutils literal notranslate"><span class="pre">PackageFinder</span></code> also has a <code class="docutils literal notranslate"><span class="pre">process_project_url()</span></code> method (called by
<code class="docutils literal notranslate"><span class="pre">find_best_candidate()</span></code>) to process a <a class="reference external" href="https://www.python.org/dev/peps/pep-0503/">PEP 503</a> “simple repository”
project page. This method fetches and parses the HTML from a PEP 503 project
page URL, extracts the anchor elements and creates <code class="docutils literal notranslate"><span class="pre">Link</span></code> objects from
them, and then evaluates those links.</p>
</section>
<section id="the-linkcollector-class">
<span id="link-collector-class"></span><h2>The <code class="docutils literal notranslate"><span class="pre">LinkCollector</span></code> class<a class="headerlink" href="#the-linkcollector-class" title="永久链接至标题">¶</a></h2>
<p>The <a class="reference internal" href="#link-collector-class"><span class="std std-ref">LinkCollector</span></a> class is the class
responsible for collecting the raw list of “links” to package files
(represented as <code class="docutils literal notranslate"><span class="pre">Link</span></code> objects) from file system locations, as well as the
<a class="reference external" href="https://www.python.org/dev/peps/pep-0503/">PEP 503</a> project page URL’s that <code class="docutils literal notranslate"><span class="pre">PackageFinder</span></code> should access.</p>
<p>The <code class="docutils literal notranslate"><span class="pre">LinkCollector</span></code> class takes into account the user’s <a class="reference internal" href="../../cli/pip_install.html#install-find-links"><span class="std std-ref">--find-links</span></a>, <a class="reference internal" href="../../cli/pip_install.html#install-extra-index-url"><span class="std std-ref">--extra-index-url</span></a>,
and related options when deciding which locations to collect links from. The
class’s main method is the <code class="docutils literal notranslate"><span class="pre">collect_sources()</span></code> method. The <a class="reference internal" href="#package-finder-class"><span class="std std-ref">PackageFinder</span></a> class invokes this method as the first step of its
<code class="docutils literal notranslate"><span class="pre">find_all_candidates()</span></code> method.</p>
<p><code class="docutils literal notranslate"><span class="pre">LinkCollector</span></code> also has a <code class="docutils literal notranslate"><span class="pre">fetch_page()</span></code> method to fetch the HTML from a
project page URL. This method is “unintelligent” in that it doesn’t parse the
HTML.</p>
<p>The <code class="docutils literal notranslate"><span class="pre">LinkCollector</span></code> class is the only class in the <code class="docutils literal notranslate"><span class="pre">index</span></code> sub-package that
makes network requests and is the only class in the sub-package that depends
directly on <code class="docutils literal notranslate"><span class="pre">PipSession</span></code>, which stores pip’s configuration options and
state for making requests.</p>
</section>
<section id="the-linkevaluator-class">
<span id="link-evaluator-class"></span><h2>The <code class="docutils literal notranslate"><span class="pre">LinkEvaluator</span></code> class<a class="headerlink" href="#the-linkevaluator-class" title="永久链接至标题">¶</a></h2>
<p>The <code class="docutils literal notranslate"><span class="pre">LinkEvaluator</span></code> class contains the business logic for determining
whether a link (e.g. in a simple repository page) satisfies minimal
conditions to be a candidate for install (resulting in an
<code class="docutils literal notranslate"><span class="pre">InstallationCandidate</span></code> object). When making this determination, the
<code class="docutils literal notranslate"><span class="pre">LinkEvaluator</span></code> instance uses information like the target Python
interpreter as well as user preferences like whether binary files are
allowed or preferred, etc.</p>
<p>Specifically, the <code class="docutils literal notranslate"><span class="pre">LinkEvaluator</span></code> class has an <code class="docutils literal notranslate"><span class="pre">evaluate_link()</span></code> method
that returns whether a link is a candidate for install.</p>
<p>Instances of this class are created by the <code class="docutils literal notranslate"><span class="pre">PackageFinder</span></code> class’s
<code class="docutils literal notranslate"><span class="pre">make_link_evaluator()</span></code> on a per-requirement basis.</p>
</section>
<section id="the-candidateevaluator-class">
<span id="candidate-evaluator-class"></span><h2>The <code class="docutils literal notranslate"><span class="pre">CandidateEvaluator</span></code> class<a class="headerlink" href="#the-candidateevaluator-class" title="永久链接至标题">¶</a></h2>
<p>The <code class="docutils literal notranslate"><span class="pre">CandidateEvaluator</span></code> class contains the business logic for evaluating
which <code class="docutils literal notranslate"><span class="pre">InstallationCandidate</span></code> objects should be preferred. This can be
viewed as a determination that is finer-grained than that performed by the
<code class="docutils literal notranslate"><span class="pre">LinkEvaluator</span></code> class.</p>
<p>In particular, the <code class="docutils literal notranslate"><span class="pre">CandidateEvaluator</span></code> class uses the whole set of
<code class="docutils literal notranslate"><span class="pre">InstallationCandidate</span></code> objects when making its determinations, as opposed
to evaluating each candidate in isolation, as <code class="docutils literal notranslate"><span class="pre">LinkEvaluator</span></code> does. For
example, whether a pre-release is eligible for selection or whether a file
whose hash doesn’t match is eligible depends on properties of the collection
as a whole.</p>
<p>The <code class="docutils literal notranslate"><span class="pre">CandidateEvaluator</span></code> class uses information like the list of <a class="reference external" href="https://www.python.org/dev/peps/pep-0425/">PEP 425</a>
tags compatible with the target Python interpreter, hashes provided by the
user, and other user preferences, etc.</p>
<p>Specifically, the class has a <code class="docutils literal notranslate"><span class="pre">get_applicable_candidates()</span></code> method.
This accepts the <code class="docutils literal notranslate"><span class="pre">InstallationCandidate</span></code> objects resulting from the links
accepted by the <code class="docutils literal notranslate"><span class="pre">LinkEvaluator</span></code> class’s <code class="docutils literal notranslate"><span class="pre">evaluate_link()</span></code> method, filters
them to a list of “applicable” candidates and orders them by preference.</p>
<p>The <code class="docutils literal notranslate"><span class="pre">CandidateEvaluator</span></code> class also has a <code class="docutils literal notranslate"><span class="pre">sort_best_candidate()</span></code> method
that returns the best (i.e. most preferred) candidate.</p>
<p>Finally, the class has a <code class="docutils literal notranslate"><span class="pre">compute_best_candidate()</span></code> method that calls
<code class="docutils literal notranslate"><span class="pre">get_applicable_candidates()</span></code> followed by <code class="docutils literal notranslate"><span class="pre">sort_best_candidate()</span></code>, and
then returning a <a class="reference internal" href="#best-candidate-result-class"><span class="std std-ref">BestCandidateResult</span></a>
object encapsulating both the intermediate and final results of the decision.</p>
<p>Instances of <code class="docutils literal notranslate"><span class="pre">CandidateEvaluator</span></code> are created by the <code class="docutils literal notranslate"><span class="pre">PackageFinder</span></code>
class’s <code class="docutils literal notranslate"><span class="pre">make_candidate_evaluator()</span></code> method on a per-requirement basis.</p>
</section>
<section id="the-candidatepreferences-class">
<span id="candidate-preferences-class"></span><h2>The <code class="docutils literal notranslate"><span class="pre">CandidatePreferences</span></code> class<a class="headerlink" href="#the-candidatepreferences-class" title="永久链接至标题">¶</a></h2>
<p>The <code class="docutils literal notranslate"><span class="pre">CandidatePreferences</span></code> class is a simple container class that groups
together some of the user preferences that <code class="docutils literal notranslate"><span class="pre">PackageFinder</span></code> uses to
construct <code class="docutils literal notranslate"><span class="pre">CandidateEvaluator</span></code> objects (via the <code class="docutils literal notranslate"><span class="pre">PackageFinder</span></code> class’s
<code class="docutils literal notranslate"><span class="pre">make_candidate_evaluator()</span></code> method).</p>
<p>A <code class="docutils literal notranslate"><span class="pre">PackageFinder</span></code> instance has a <code class="docutils literal notranslate"><span class="pre">_candidate_prefs</span></code> attribute whose value
is a <code class="docutils literal notranslate"><span class="pre">CandidatePreferences</span></code> instance. Since <code class="docutils literal notranslate"><span class="pre">PackageFinder</span></code> has a number
of responsibilities and options that control its behavior, grouping the
preferences specific to <code class="docutils literal notranslate"><span class="pre">CandidateEvaluator</span></code> helps maintainers know which
attributes are needed only for <code class="docutils literal notranslate"><span class="pre">CandidateEvaluator</span></code>.</p>
</section>
<section id="the-bestcandidateresult-class">
<span id="best-candidate-result-class"></span><h2>The <code class="docutils literal notranslate"><span class="pre">BestCandidateResult</span></code> class<a class="headerlink" href="#the-bestcandidateresult-class" title="永久链接至标题">¶</a></h2>
<p>The <code class="docutils literal notranslate"><span class="pre">BestCandidateResult</span></code> class is a convenience “container” class that
encapsulates the result of finding the best candidate for a requirement.
(By “container” we mean an object that simply contains data and has no
business logic or state-changing methods of its own.) It stores not just the
final result but also intermediate values used to determine the result.</p>
<p>The class is the return type of both the <code class="docutils literal notranslate"><span class="pre">CandidateEvaluator</span></code> class’s
<code class="docutils literal notranslate"><span class="pre">compute_best_candidate()</span></code> method and the <code class="docutils literal notranslate"><span class="pre">PackageFinder</span></code> class’s
<code class="docutils literal notranslate"><span class="pre">find_best_candidate()</span></code> method.</p>
</section>
</section>

        </article>
      </div>
      <footer>
        
        <div class="related-pages">
          <a class="next-page" href="command-line-interface.html">
              <div class="page-info">
                <div class="context">
                  <span>Next</span>
                </div>
                <div class="title">Command Line Interface</div>
              </div>
              <svg><use href="#svg-arrow-right"></use></svg>
            </a>
          <a class="prev-page" href="configuration-files.html">
              <svg><use href="#svg-arrow-right"></use></svg>
              <div class="page-info">
                <div class="context">
                  <span>Previous</span>
                </div>
                
                <div class="title">Configuration File Handling</div>
                
              </div>
            </a>
        </div>

        <div class="related-information">
              <a href="../../copyright.html">Copyright</a> &#169; The pip developers. |
            Built with <a href="https://www.sphinx-doc.org/">Sphinx</a>
              and
              <a class="muted-link" href="https://pradyunsg.me">@pradyunsg</a>'s
              <a href="https://github.com/pradyunsg/furo">Furo theme</a>. |
            <a class="muted-link" href="../../_sources/development/architecture/package-finding.rst.txt"
               rel="nofollow">
              显示源代码
            </a>
        </div>
        
      </footer>
    </div>
    <aside class="toc-drawer">
      
      
      <div class="toc-sticky toc-scroll">
        <div class="toc-title-container">
          <span class="toc-title">
            目录
          </span>
        </div>
        <div class="toc-tree-container">
          <div class="toc-tree">
            <ul>
<li><a class="reference internal" href="#">Finding and choosing files (<code class="docutils literal notranslate"><span class="pre">index</span></code> and <code class="docutils literal notranslate"><span class="pre">PackageFinder</span></code>)</a><ul>
<li><a class="reference internal" href="#overview">Overview</a></li>
<li><a class="reference internal" href="#the-packagefinder-class">The <code class="docutils literal notranslate"><span class="pre">PackageFinder</span></code> class</a></li>
<li><a class="reference internal" href="#the-linkcollector-class">The <code class="docutils literal notranslate"><span class="pre">LinkCollector</span></code> class</a></li>
<li><a class="reference internal" href="#the-linkevaluator-class">The <code class="docutils literal notranslate"><span class="pre">LinkEvaluator</span></code> class</a></li>
<li><a class="reference internal" href="#the-candidateevaluator-class">The <code class="docutils literal notranslate"><span class="pre">CandidateEvaluator</span></code> class</a></li>
<li><a class="reference internal" href="#the-candidatepreferences-class">The <code class="docutils literal notranslate"><span class="pre">CandidatePreferences</span></code> class</a></li>
<li><a class="reference internal" href="#the-bestcandidateresult-class">The <code class="docutils literal notranslate"><span class="pre">BestCandidateResult</span></code> class</a></li>
</ul>
</li>
</ul>

          </div>
        </div>
      </div>
      
      
    </aside>
  </div>
</div><script data-url_root="../../" id="documentation_options" src="../../_static/documentation_options.js"></script>
    <script src="../../_static/jquery.js"></script>
    <script src="../../_static/underscore.js"></script>
    <script src="../../_static/doctools.js"></script>
    <script src="../../_static/scripts/main.js"></script>
    <script src="../../_static/clipboard.min.js"></script>
    <script src="../../_static/copybutton.js"></script>
    <script src="../../_static/tabs.js"></script>
    <script src="../../_static/translations.js"></script>
    </body>
</html>